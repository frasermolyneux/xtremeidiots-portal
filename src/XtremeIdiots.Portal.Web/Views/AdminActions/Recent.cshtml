@using XtremeIdiots.Portal.Repository.Abstractions.Models.V1.AdminActions
@using XtremeIdiots.Portal.Repository.Abstractions.Constants.V1
@model List<AdminActionDto>
@{
    var scope = (ViewData["Scope"] as string) ?? "my";
    ViewData["Title"] = "Recent Admin Actions";
}
<div class="wrapper wrapper-content animated fadeInRight">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <div class="btn-group" role="group" aria-label="Scope toggle">
            <a asp-action="Recent" asp-route-scope="my"
                class="btn btn-sm @(scope == "my" ? "btn-primary" : "btn-outline-primary")">My Games</a>
            <a asp-action="Recent" asp-route-scope="all"
                class="btn btn-sm @(scope == "all" ? "btn-primary" : "btn-outline-primary")">All Games</a>
        </div>
        <small class="text-muted">Showing @Model.Count recent actions (@(scope == "my" ? "My Games" : "All Games"))</small>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-info">No recent admin actions found for this scope.</div>
    }

    <div class="row row-cols-1 row-cols-md-3 g-4">
        @foreach (var a in Model)
        {
            var cardStyle = a.Type switch
            {
                AdminActionType.Observation => "primary",
                AdminActionType.Warning => "warning",
                AdminActionType.Kick => "warning",
                AdminActionType.TempBan => a.Expires < DateTime.UtcNow ? "secondary" : "danger",
                AdminActionType.Ban => a.Expires != null ? "secondary" : "danger",
                _ => "info"
            };
            <div class="col">
                <div class="card h-100 border-top border-@cardStyle border-3 shadow-sm">
                    <div class="card-body d-flex flex-column">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h6 class="card-title mb-0 fw-bold">@a.Type</h6>
                            <span class="badge bg-light text-dark">@a.Player?.GameType</span>
                        </div>
                        <div class="mb-2">
                            <a asp-controller="Players" asp-action="Details" asp-route-id="@a.PlayerId"
                                class="fw-semibold">@a.Player?.Username</a>
                            <br />
                            <small class="text-muted">@a.Player?.Guid</small>
                        </div>
                        <div class="flex-grow-1 small mb-2 admin-action-text" style="max-height:120px; overflow:auto;">
                            @Html.Raw(a.Text.Length > 300 ? a.Text.Substring(0, 300) + "..." : a.Text)
                        </div>
                        <div class="mt-auto d-flex justify-content-between align-items-end">
                            <small class="text-muted">@a.Created.ToString("MMM dd HH:mm") UTC</small>
                            <small class="text-muted">@((a.UserProfile?.DisplayName) ?? "Unclaimed")</small>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
